<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>ðŸŽ® Color Match Rush</title>
<style>
:root{color-scheme:dark}*{box-sizing:border-box;margin:0;padding:0}body{background:linear-gradient(135deg,#0a0e13 0%,#1a1f2e 100%);color:#e7ecf0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;display:flex;flex-direction:column;align-items:center;min-height:100dvh;padding:20px}.wrap{width:min(900px,96vw);position:relative}.card{background:#12171b;border:1px solid #1f2a32;border-radius:14px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}.overlay{position:fixed;inset:0;display:grid;place-items:center;background:rgba(8,11,14,.85);backdrop-filter:blur(4px);padding:16px;z-index:100}.hidden{display:none!important}h1{font-size:28px;font-weight:900;margin-bottom:12px;text-shadow:0 2px 10px rgba(56,189,248,0.5)}.muted{color:#9aa7b1;font-size:14px;line-height:1.4;margin-bottom:16px}.btn-primary{padding:14px 28px;background:linear-gradient(135deg,#ff8c42,#ff6b1a);color:#fff;border:none;border-radius:12px;font-weight:900;font-size:16px;cursor:pointer;box-shadow:0 6px 20px rgba(255,107,26,0.4);transition:all 0.2s;text-transform:uppercase;letter-spacing:0.5px}.btn-primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,107,26,0.5)}.btn-primary:disabled{opacity:0.6;cursor:not-allowed}#status{margin-top:15px;font-size:13px;line-height:1.5;background:#0f151a;border:1px solid #1f2a32;border-radius:10px;padding:12px}#status b{color:#cde7d8}#status .ok{color:#4ade80}#status .warn{color:#fbbf24}#status .err{color:#f87171}#status a{color:#86c6ff;text-decoration:none}#game-container{width:100%;position:relative;display:none}#game-container.active{display:block}.game-canvas-wrapper{background:#0d1117;border:3px solid #1f2937;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.5);overflow:hidden;margin:20px auto;max-width:100%}#game-canvas{display:block;width:100%;height:500px}.game-hud{background:rgba(15,23,42,0.8);border:2px solid #1e293b;border-radius:12px;padding:15px;display:flex;align-items:center;justify-content:space-around;gap:15px;flex-wrap:wrap;margin-top:15px}.hud-item{display:flex;flex-direction:column;align-items:center;gap:5px}.hud-label{font-weight:700;font-size:12px;color:#94a3b8;text-transform:uppercase;letter-spacing:0.5px}.hud-value{font-size:20px;font-weight:900;color:#fbbf24}#play-again{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);padding:16px 32px;background:linear-gradient(135deg,#ff8c42,#ff6b1a);color:#fff;border:none;border-radius:12px;font-weight:900;font-size:18px;cursor:pointer;box-shadow:0 10px 40px rgba(255,107,26,0.5);z-index:50}@media (max-width:720px){.game-hud{justify-content:space-between}}
</style>
</head>
<body>
<div class="wrap">
<div id="intro-overlay" class="overlay">
<div class="card">
<h1>ðŸŽ® Play Color Match Rush</h1>
<p class="muted">A small Base transfer is required to start playing (mobile & desktop supported).</p>
<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
<div class="muted" style="font-size:12px">Change recipient/amount in code if needed.</div>
<button id="play" class="btn-primary">ðŸ’° Pay & Play</button>
</div>
<div id="status" class="hidden"></div>
</div>
</div>
<div id="game-container">
<div class="game-canvas-wrapper">
<div id="game-canvas"></div>
</div>
<div class="game-hud">
<div class="hud-item"><span class="hud-label">Score</span><span class="hud-value" id="scoreDisplay">0</span></div>
<div class="hud-item"><span class="hud-label">Timer</span><span class="hud-value" id="timerDisplay" style="color:#ef4444">15s</span></div>
</div>
<button id="play-again" class="hidden">ðŸ’° Pay & Play Again</button>
</div>
</div>
<script type="module">
// Only call ready if sdk is available
if (window.farcaster?.sdk) {
  window.farcaster.sdk.actions.ready();
} else if (window.sdk) {
  window.sdk.actions.ready();
}

const USE_BASE_SEPOLIA=!1,RECIPIENT="0xeEa2d9A4B21B23443bF01C1ccD31632107eD8Ec1",AMOUNT_ETH="0.00001",BASE_MAINNET={chainId:"0x2105",explorer:"https://basescan.org/tx/"},BASE_SEPOLIA={chainId:"0x14a34",explorer:"https://sepolia.basescan.org/tx/"},TARGET=USE_BASE_SEPOLIA?BASE_SEPOLIA:BASE_MAINNET,statusEl=document.getElementById('status'),playBtn=document.getElementById('play'),playAgainBtn=document.getElementById('play-again'),scoreDisplay=document.getElementById('scoreDisplay'),timerDisplay=document.getElementById('timerDisplay'),showStatus=()=>statusEl.classList.remove('hidden'),addLine=e=>{showStatus();statusEl.insertAdjacentHTML('beforeend',`<div>${e}</div>`)},clearStatus=()=>statusEl.innerHTML='',disable=(e,t=!0)=>{e&&(e.disabled=t)};function parseEther(e){const[t,a=""]=(e+"").split('.'),s=(a+'0'.repeat(18)).slice(0,18);return'0x'+(BigInt(t)*10n**18n+BigInt(s)).toString(16)}async function getProvider(){try{const e=await sdk.wallet.getEthereumProvider();if(e)return e}catch{}return window.ethereum??null}async function ensureChain(e,t){const a=(await e.request({method:'eth_chainId'}))?.toLowerCase();if(a===t.toLowerCase())return;try{await e.request({method:'wallet_switchEthereumChain',params:[{chainId:t}]})}catch(a){if(4902===a?.code){await e.request({method:'wallet_addEthereumChain',params:[{chainId:t}]});await e.request({method:'wallet_switchEthereumChain',params:[{chainId:t}]})}else throw a}}async function requiredPayment(){clearStatus();addLine(`<b>Step 1:</b> Locating wallet providerâ€¦`);const e=await getProvider();if(!e){addLine(`<span class="err">No wallet available.</span> Open in Farcaster or enable a wallet.`);throw new Error('NO_PROVIDER')}addLine(`<span class="ok">Provider ready.</span>`);addLine(`<b>Step 2:</b> Requesting accountsâ€¦`);const[t]=await e.request({method:'eth_requestAccounts'});addLine(`<span class="ok">Account: ${t.slice(0,6)}â€¦${t.slice(-4)}</span>`);addLine(`<b>Step 3:</b> Switching to Base${USE_BASE_SEPOLIA?' Sepolia':''}â€¦`);await ensureChain(e,TARGET.chainId);addLine(`<span class="ok">On Base${USE_BASE_SEPOLIA?' Sepolia':''}.</span>`);addLine(`<b>Step 4:</b> Sending ${AMOUNT_ETH} ETH to ${RECIPIENT.slice(0,6)}â€¦${RECIPIENT.slice(-4)}â€¦`);const a=await e.request({method:'eth_sendTransaction',params:[{from:t,to:RECIPIENT,value:parseEther(AMOUNT_ETH)}]});addLine(`<span class="ok">TX sent.</span> <a target="_blank" rel="noopener" href="${TARGET.explorer}${a}">View on Basescan</a>`);return a}async function payThen(e,t){try{disable(t,!0);await requiredPayment();await e()}catch(e){console.warn('Payment gate blocked action:',e);addLine(`<span class="warn">Payment required. Please try again.</span>`)}finally{disable(t,!1)}}const script=document.createElement('script');script.src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';script.onload=initGame;document.head.appendChild(script);function initGame(){const THREE=window.THREE;let scene,camera,renderer,arrow,bands=[],trailDots=[];let currentColorIndex=0,score=0,timeLeft=15;let speed=0.07,bandSpacing=8,arrowTargetX=0;let gameActive=!1,animationId=null,timerInterval=null;const colors=[{name:'cyan',hex:0x00d4aa},{name:'yellow',hex:0xffd700},{name:'pink',hex:0xff6b9d}];function setupScene(){scene=new THREE.Scene();scene.background=new THREE.Color(0x0d1117);const e=900/500;camera=new THREE.OrthographicCamera(-5*e,5*e,5,-5,.1,100);camera.position.set(0,0,10);camera.lookAt(0,0,0);renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(900,500);const t=document.getElementById('game-canvas');t.innerHTML='';t.appendChild(renderer.domElement);const a=new THREE.AmbientLight(0xffffff,.8);scene.add(a);const s=new THREE.DirectionalLight(0xffffff,.5);s.position.set(0,0,5);scene.add(s);const r=new THREE.Shape();r.moveTo(0,.5);r.lineTo(-.4,-.3);r.lineTo(.4,-.3);r.lineTo(0,.5);const o=new THREE.ShapeGeometry(r),n=new THREE.MeshBasicMaterial({color:colors[0].hex,side:THREE.DoubleSide});arrow=new THREE.Mesh(o,n);arrow.position.set(0,-3.5,0);scene.add(arrow);for(let e=0;e<4;e++){const t=new THREE.CircleGeometry(.08-e*.015,16),a=new THREE.MeshBasicMaterial({color:0xffffff,transparent:!0,opacity:.8-e*.15}),s=new THREE.Mesh(t,a);s.position.set(0,-3.5-.3*(e+1),.01);scene.add(s);trailDots.push(s)}for(let e=0;e<3;e++)createBandSet(4+e*bandSpacing);window.addEventListener('mousemove',onMouseMove);window.addEventListener('touchmove',onTouchMove)}function createBandSet(e){const t=[-2.5,0,2.5],a=[...colors].sort(()=>Math.random()-.5);t.forEach((t,s)=>{const r=new THREE.BoxGeometry(2.4,.6,.1),o=new THREE.MeshBasicMaterial({color:a[s].hex,emissive:a[s].hex,emissiveIntensity:.3}),n=new THREE.Mesh(r,o);n.position.set(t,e,0);n.userData={colorIndex:colors.findIndex(e=>e.hex===a[s].hex),checked:!1};const i=new THREE.BoxGeometry(2.5,.65,.11),c=new THREE.MeshBasicMaterial({color:0x000000,side:THREE.BackSide}),l=new THREE.Mesh(i,c);n.add(l);scene.add(n);bands.push(n)})}function onMouseMove(e){const t=e.clientX/900*2-1;arrowTargetX=4*t}function onTouchMove(e){const t=e.touches[0].clientX/900*2-1;arrowTargetX=4*t}function animate(){animationId=requestAnimationFrame(animate);if(arrow&&gameActive){arrow.position.x+=(arrowTargetX-arrow.position.x)*.15;arrow.position.x=Math.max(-3.5,Math.min(3.5,arrow.position.x));trailDots.forEach((e,t)=>{e.position.x+=(arrow.position.x-e.position.x)*(.12-t*.02)});bands.forEach((e,t)=>{e.position.y-=speed;if(!e.userData.checked&&e.position.y<=-3.2&&e.position.y>=-3.8){const t=e.position.x-1.2,a=e.position.x+1.2,s=arrow.position.x;if(s>=t&&s<=a){if(e.userData.colorIndex===currentColorIndex){e.userData.checked=!0;score+=10;scoreDisplay.textContent=score;currentColorIndex=(currentColorIndex+1)%colors.length;arrow.material.color.setHex(colors[currentColorIndex].hex);e.material.emissiveIntensity=.8}else endGame()}}if(e.position.y<-6){scene.remove(e);bands.splice(t,1);const a=bands.reduce((e,t)=>Math.max(e,t.position.y),-10);a<3&&createBandSet(a+bandSpacing)}});speed=Math.min(.15,.07+score*3e-4);bandSpacing=Math.max(3,8-score*.03)}renderer.render(scene,camera)}function startTimer(){timeLeft=15;timerDisplay.textContent=timeLeft+'s';timerInterval=setInterval(()=>{timeLeft--;timerDisplay.textContent=timeLeft+'s';if(timeLeft<=0)endGame()},1000)}function endGame(){gameActive=!1;if(timerInterval)clearInterval(timerInterval);if(animationId)cancelAnimationFrame(animationId);renderer.domElement.style.filter='blur(4px)';playAgainBtn.classList.remove('hidden')}function resetGame(){bands.forEach(e=>scene.remove(e));bands=[];currentColorIndex=0;score=0;timeLeft=15;speed=.07;bandSpacing=8;arrowTargetX=0;scoreDisplay.textContent='0';timerDisplay.textContent='15s';if(arrow){arrow.position.x=0;arrow.material.color.setHex(colors[0].hex)}for(let e=0;e<3;e++)createBandSet(4+e*bandSpacing);gameActive=!0;if(!animationId)animate();startTimer();renderer.domElement.style.filter='none'}playBtn.addEventListener('click',e=>{e.preventDefault();payThen(()=>{document.getElementById('intro-overlay').classList.add('hidden');document.getElementById('game-container').classList.add('active');if(!renderer)setupScene();resetGame()},playBtn)});playAgainBtn.addEventListener('click',e=>{e.preventDefault();payThen(()=>{playAgainBtn.classList.add('hidden');resetGame()},playAgainBtn)})}window.addEventListener('error',e=>console.error('Error:',e.error||e));window.addEventListener('unhandledrejection',e=>console.error('Unhandled promise:',e.reason));
</script>
</body>
</html>



